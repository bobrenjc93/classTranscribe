[{"text":"so this getaddrinfo() is ","width":1358.1818182468414},{"text":"sort of a powerhouse of a call","width":163.18181824684143},{"text":"it does an awful lot of work behind the scenes","width":133.18181824684143},{"text":"including making a network connection, say \"hey! hey, anybody! anybody know who this is? www.illinois.edu? anybody got an ip address to this?\"","width":822.1818182468414},{"text":"so what am i talking about? i'm talking about","width":271.18181824684143},{"text":"dns, and we'll talk more about dns a different time","width":213.18181824684143},{"text":"well that itself, but that call itself could be making network requests to say \"hey i need the ip address that's connected to this name\"","width":559.1818182468414},{"text":"so the whole lot of stuff that happens behind the scenes just to discover the ip address","width":434.18181824684143},{"text":"right, so what does the ip address go into? it goes into one of these structs","width":504.18181824684143},{"text":"and where does the ip address actually appear?","width":223.18181824684143},{"text":"it actually appears inside here, this little [gibberish] here, this address, and this other thing called addrlen is set","width":553.1818182468414},{"text":"so why can address be different lengths?","width":193.18181824684143},{"text":"well, socket is an abstract idea, and it might have different kinds of sockets","width":350.18181824684143},{"text":"we might have an ip4 type socket, or we might have an ip6 kind of socket, or we might have an apple talk socket","width":447.18181824684143},{"text":"so these c structures are actually designed to be potentially different lengths, so when we call connect, we actually have to say \"and this is actually the size of my data structure\"","width":1232.1818182468414},{"text":"right, so","width":138.18181824684143},{"text":"so what have we got? we've got getaddrinfo() to fill out that socket information for me","width":293.18181824684143},{"text":"if we didn't have this, we'd be writing lots more code, and it's really ugly, it's got lots of casts in it","width":350.18181824684143},{"text":"the beautiful thing about this is we set up a hints thing, we say do we want ip4 or ip6, or we don't care, and we say say the socket stream, or we want UDP, and then we create a socket and we can connect to it","width":927.1818182468414},{"text":"and we're done! we're ready for action! right","width":250.18181824684143},{"text":"let's write some code then","width":257.18181824684143},{"text":"so connect will do the handshaking, so now we're going to actually use this thing ","width":481.18181824684143},{"text":"right, so i need to send it something, okay","width":339.18181824684143},{"text":"right, so what i'm going to send?","width":140.18181824684143},{"text":"here can be my request","width":250.18181824684143},{"text":"it'll say \"GET\" homepage","width":323.18181824684143},{"text":"make that larger, here we go","width":103.18181824684143},{"text":"right","width":39.18181824684143},{"text":"get the home page, i'm going to speak http/1.0 to you, and i need to send it these newline characters to say that's the end of my request \"/r/n\", if i wrote it twice","width":997.1818182468414},{"text":"okay, we could ","width":183.18181824684143},{"text":"for debugging let's just print this out","width":455.18181824684143},{"text":"okay","width":104.18181824684143},{"text":"and i'm going to write the minimum code that will kind of work, this is not robust quality code by any means","width":415.18181824684143},{"text":"that we'd used a real web server, or any other client","width":242.18181824684143},{"text":"but it's good enough for lecture demo today","width":122.18181824684143},{"text":"right, so","width":46.18181824684143},{"text":"how do we use write()?","width":49.18181824684143},{"text":"well, remember that you need to give it a file descriptor","width":166.18181824684143},{"text":"okay, that's what i got from the socket","width":359.18181824684143},{"text":"you need to give it a pointer to some bytes that we want to send","width":195.18181824684143},{"text":"okay, that was my request","width":210.18181824684143},{"text":"and i need the number of bytes, yes","width":558.1818182468414},{"text":"if","width":80.18181824684143},{"text":"right, even number of bytes","width":199.18181824684143},{"text":"so, could i say request?","width":610.1818182468414},{"text":"how many, what is the size of request?","width":254.18181824684143},{"text":"that's 4 bytes or 8 bytes?","width":214.18181824684143},{"text":"because it's a pointer, it's not - we didn't specify it as an array","width":195.18181824684143},{"text":"remember arrays, kind of like pointers, but they're not pointers","width":224.18181824684143},{"text":"if you ask for the size of a pointer, you get a size of a pointer, which is 4 bytes on a 32-bit machine, 8 bytes on a 64","width":425.18181824684143},{"text":"we didn't want that","width":77.18181824684143},{"text":"we could've either made request a different type, we could've made it a character array, or we could just calculate it during runtime","width":435.18181824684143},{"text":"so let's do it during runtime","width":55.18181824684143},{"text":"so strlen(), give me the number of characters inside request","width":432.18181824684143},{"text":"i do not need to send the 0 byte","width":208.18181824684143},{"text":"the protocol is not about c-strings, it's the end of the line, the end of the request is to find in terms of these double newline characters, right","width":648.1818182468414},{"text":"so we send that ","width":130.18181824684143},{"text":"i could get the return value to see how many bytes were sent, but nah, it's a lecture","width":286.18181824684143},{"text":"right, so","width":144.18181824684143},{"text":"let's get back to response, okay, we need some space for that, so as this is just a quick demo, we'll just have some space on the stack here","width":648.1818182468414},{"text":"it gives to my response","width":347.18181824684143},{"text":"and ","width":302.18181824684143},{"text":"let's read from that socket","width":208.18181824684143},{"text":"right, sock_fd","width":103.18181824684143},{"text":"i need to give it a pointer to some space, some memory","width":213.18181824684143},{"text":"how many bytes do i want to read up to? we'll say 999","width":236.18181824684143},{"text":"why 999? well, because if length is, get at least one thing","width":579.1818182468414},{"text":"we will print it out as a c-string, so i'm going to terminate it","width":611.1818182468414},{"text":"and finally, we'll print it out","width":653.1818182468414},{"text":"okay","width":207.18181824684143},{"text":"questions at this point?","width":366.18181824684143},{"text":"aha, it's easy! right?","width":220.18181824684143},{"text":"the file descriptor wasn't set once i called connect()","width":363.18181824684143},{"text":"i've connected!","width":93.18181824684143},{"text":"i am network man!","width":71.18181824684143},{"text":"anyway, so we've now got the power of the internet at our fingertips","width":374.18181824684143},{"text":"well at least","width":98.18181824684143},{"text":"all of the internet we can connect to using TCP","width":257.18181824684143},{"text":"right, so let me","width":283.18181824684143},{"text":"[gibberish] okay, we'll do illinois to begin with","width":128.18181824684143},{"text":"right, so","width":94.18181824684143},{"text":"we'll run this ","width":312.18181824684143},{"text":"what'll i call the code?","width":128.18181824684143},{"text":"[gibberish]","width":163.18181824684143},{"text":"alright, awesome","width":180.18181824684143},{"text":"[gibberish]","width":255.18181824684143},{"text":"ah! great, happy days","width":90.18181824684143},{"text":"right, so let's run awesome","width":236.18181824684143},{"text":"hey! look at that!","width":148.18181824684143},{"text":"we wrote some c code, we connected to another machine!","width":205.18181824684143},{"text":"this is what it's all about, this is what makes 241 so powerful, right?","width":214.18181824684143},{"text":"now we can actually talk to any Â machine, and now i can run my machine, i can run this a hundred thousand times, and run a ddos attack on the internet","width":733.1818182468414},{"text":"don't do that","width":193.18181824684143},{"text":"because every server, of course, can log the ip address","width":399.18181824684143},{"text":"and log the content of what's being sent to it","width":121.18181824684143}]