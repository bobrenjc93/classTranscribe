[{"text":"so your homework for this week is to go and upgrade please","width":284},{"text":"go and get one of those uiuc brains please","width":161},{"text":"um because this stuff is really hard, we're looking at one piece of code but thinking about it for what could happen when two different threads happen at the same time","width":454},{"text":"and you're thinking about the sad days, your thinking about what could possibly go wrong","width":402},{"text":"we're not thinking about oh my code works great, it's no no let's look at this really really critically","width":414},{"text":"yes so our problem would be if two threads came along called lock at the same time and they both read a value of zero for the lock value","width":553},{"text":"before either of them had a chance to change it to one","width":279},{"text":"not very likely but that's not good enough, we're trying to make code that actually works","width":315},{"text":"that doesn't make us lose money or corrupt our data structure","width":332},{"text":"at the end there can only be one thread that gets through this","width":312},{"text":"alright I talk about threads because that's how we program this stuff","width":235},{"text":"but if you read the historic literature, it talks about processes that's because we're thinking about this actually in a more abstract sense","width":550},{"text":"not about pthreads and c structures but just how do we actually do this so that it works","width":523},{"text":"alright so this is broken, the only way that we could have made this code work is if we had somehow done all of this as kind of one operation","width":628},{"text":"but we can't do that","width":61},{"text":"in c","width":47},{"text":"you can't say okay I'm the gorilla, whilst I look at this lock, don't let anyone else look at it or touch it, alright?","width":448},{"text":"how do I do that? easy, make a lock, oh wait that's what I'm trying to do right?","width":203},{"text":"so that's not going to work for us","width":138},{"text":"okay so that failed, what we failed at was mutual exclusion","width":583},{"text":"we only want one thread or process if you're talking historically inside our critical section","width":1154},{"text":"so let's try a different solution, let's try our first real candidate solution","width":499},{"text":"we'll have um. we'll agree on the following","width":159},{"text":"now before you panic, the code written out here, the pseudocode is the same as the pseudocode on the right hand side","width":430},{"text":"the reason we wrote it twice is because I want you to think about two threads or two processes trying to execute this at the same time","width":439},{"text":"and see if we can actually kind of prevent bad things from happening","width":194},{"text":"so what we'll do is we'll have some flags","width":239},{"text":"we'll say look, I'm going to just wait until your flag is lowered","width":404},{"text":"and your thread will do the same","width":379},{"text":"so if I see that your flag is up, then I know that you are inside the critical section","width":752},{"text":"in which case I'm just going to wait","width":398},{"text":"once I decide that your flag is down, I'm going to raise my flag, I can do my stuff and then I'll lower my flag","width":435},{"text":"now we can say what happens if I have three or four or five or more threads in this, let's not","width":327},{"text":"let's just worry about what happens with just two threads or two processes trying to do that","width":314},{"text":"this is hard enough with just two","width":136},{"text":"alright so does this work, does this suffer from the same problem?","width":270},{"text":"or not?","width":66},{"text":"okay you decide and see if you can argue it with your neighbor","width":480},{"text":"[silence]","width":3168},{"text":"okay! so, does it work? yes it does great, end of lecture","width":321},{"text":"no of course it doesn't work","width":120},{"text":"right? so does it work? no! why not?","width":475},{"text":"let's hear from someone over here, yes","width":559},{"text":"they both could be waiting forever, uhhhhhhh, I think that might be hard, I think we can assume that their flags are initially down","width":801},{"text":"alright so how will they get to have both of them up?","width":420},{"text":"come on keep going","width":795},{"text":"alright so we have a potential problem right? yes that both people or both threads could see each other and say oh look his flag is down","width":731},{"text":"great I can continue, at which point we raise our flag and say alright off I go","width":309},{"text":"and they do this at exactly the same time, or about the same time","width":540},{"text":"so hey i'm going to wait until your flag is lowered and I'm going to wait until your flag is lowered","width":344},{"text":"they check each others flags they are both low so they can both proceed","width":302},{"text":"they raise their flags to say okay I'm going in","width":164},{"text":"but it's too late, they've both gotten past this little loop!","width":189},{"text":"so they both go into the critical section so what we have failed on the mutual exclusion principle game again","width":700},{"text":"we did not get mutual exclusion","width":123},{"text":"we wanted one person inside our critical section at a time thank you very much and we failed","width":511},{"text":"so when we're looking at these solutions, we've got to evaluate them a little bit carefully because it can happen more than once","width":438},{"text":"you could imagine you're going to wrap this around some data structure update like hey I want to add something to my linked list","width":344},{"text":"or add something to my hash","width":109},{"text":"and I don't know where I'm going to do it but I do know I'm going to say insert things into my hash or read my hash multiple times","width":647},{"text":"right so, let's be sneaky, let's be guided by what we did before","width":324},{"text":"and this time we're going to raise our flag first","width":266},{"text":"that way hopefully, we can stop this mutual exclusion problem","width":280},{"text":"okay what's wrong with this solution, right so again the code here is the same as this code here","width":351},{"text":"you could just imagine that this is person A and person B or thread A and thread B","width":252},{"text":"what happens now? what could possibly go wrong?","width":224},{"text":"again take a moment to argue this with your neighbor and even if you don't agree with them perhaps you can persuade them that you're right","width":512},{"text":"[silence]","width":1920}]