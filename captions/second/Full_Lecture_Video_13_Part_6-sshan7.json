[{"text":"okay so I only have about five more minutes left I don't think I'm going to be able to ","width":242},{"text":"any more questions left about this sorry","width":255},{"text":"any more questions about the ring buffer","width":236},{"text":"okay the back half of the page","width":428},{"text":"is return to the reader-writer problem","width":361},{"text":"okay","width":180},{"text":"so you guys remember what the reader-writer problem is?","width":369},{"text":"so there's a couple of rules when you're doing a reader-writer problem","width":242},{"text":"1. how many readers can you have at the same time?","width":372},{"text":"as many as you want","width":76},{"text":"how many writers can you have at the same time","width":159},{"text":"one","width":38},{"text":"can you have readers and writers at the same time?","width":168},{"text":"no","width":45},{"text":"so our first rule is exclusion","width":206},{"text":"one writer multiple readers","width":199},{"text":"that also means that whatever solution I design I want to be able to allow multiple readers to simultaneously read","width":492},{"text":"but only one writer to write at the same time","width":259},{"text":"so was there anything else?","width":498},{"text":"yes and we want to make sure that whatever solution we come up with doesn't starve either the readers or the writers","width":664},{"text":"so you guys saw condition variables right?","width":302},{"text":"so just to refresh your memory","width":173},{"text":"inside a condition variable","width":220},{"text":"inside the system it's doing an unlock on a mutex","width":248},{"text":"it's blocking on a signal","width":128},{"text":"so it's waiting for something","width":59},{"text":"and then when it's done it locks it","width":105},{"text":"and then it returns","width":102},{"text":"so whenever you call a condition variable","width":272},{"text":"you call it with both that condition variable and a lock","width":311},{"text":"what state does that lock have to be in?","width":191},{"text":"locked","width":47},{"text":"because in the system the first thing that happens is the system unlocks it for you","width":231},{"text":"but all that is done atomically-ish","width":206},{"text":"don't worry about that word","width":80},{"text":"it's all done in one step so you don't have to worry about race conditions inside the condition variable","width":345},{"text":"okay","width":88},{"text":"so here's my first solution","width":293},{"text":"to the reader-writer problem","width":259},{"text":"I'm going to lock a mutex and then I'm going to say ","width":395},{"text":"I have some variables here","width":156},{"text":"I have writing ","width":191},{"text":"that means somebody's writing","width":164},{"text":"and I have reading","width":215},{"text":"and that tells me how many the number of readers inside","width":318},{"text":"what value can writing be?","width":193},{"text":"zero one ","width":70},{"text":"reading can be whatever doesn't matter","width":165},{"text":"ok so, first thing I'm going to do is lock my variable and call","width":305},{"text":"and while somebody is writing I'm going to call my condition wait","width":280},{"text":"if somebody if there's a writer in there I'm going to wait for the writer to signal that they're done","width":386},{"text":"and then I can go on","width":126},{"text":"once that's done I increment reading","width":177},{"text":"I do my reading, I decrement reading, I signal that I'm done and I lock","width":371},{"text":"similarly, on the writer side ","width":179},{"text":"they lock","width":65},{"text":"if there's anybody reading or writing","width":166},{"text":"remember writers are exclusive they can't have anybody in there","width":219},{"text":"I wait increment writing, decrement writing call the condition variable","width":605},{"text":"if anybody, this we're a little bit short for time","width":130},{"text":"so is anybody off the top of their head see a problem with this","width":416},{"text":"there's only one reader at a time","width":131},{"text":"what's causing that?","width":128},{"text":"the lock, right, so the lock goes from here to here","width":306},{"text":"once I try to read and I acquire the lock nobody else can come in","width":255},{"text":"does anybody know how I can fix that?","width":245},{"text":"there's an easier way to do that?","width":190},{"text":"any other suggestions?","width":131},{"text":"well I have to lock","width":167},{"text":"but you're closer it does have to do with the lock","width":281},{"text":"what if we unlock the lock","width":262},{"text":"unlock before the reading and then relock","width":527},{"text":"right?","width":78},{"text":"because this unlock will let the other readers pass","width":307},{"text":"the writers will get here and stop","width":221},{"text":"because I've already incremented my reading so the writers aren't going to be able to get into the critical section, but the other readers will","width":729},{"text":"there's another problem","width":96},{"text":"am I done?","width":173},{"text":"give me one more problem here","width":90},{"text":"there's two more problem, we'll finish them on wednesday","width":520},{"text":"say that again?","width":187},{"text":"if there's a stream of readers","width":150},{"text":"if readers keep coming and keep coming and there's never no readers","width":257},{"text":"we're going to starve our writers","width":103},{"text":"one more problem","width":93},{"text":"I lied","width":241},{"text":"look at the writers for a second there's a problem here","width":435},{"text":"what does that do?","width":227},{"text":"what does a condition signal do?","width":349},{"text":"it wakes up what?","width":151},{"text":"no","width":59},{"text":"it wakes up ","width":110},{"text":"wakes up one reader","width":92},{"text":"what do i need to change that to?","width":224},{"text":"condition broadcast","width":239},{"text":"okay","width":183},{"text":"I want you guys to think about the better solution for a reader-writer","width":248},{"text":"we'll go over that at the beginning of class on Wednesday","width":132},{"text":"and we'll talk about deadlock","width":256}]