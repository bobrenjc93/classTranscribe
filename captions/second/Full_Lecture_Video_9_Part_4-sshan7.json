[{"text":"okay let me tell you how hard this example is","width":414},{"text":"for giggles, when I wrote this little problem I challenged a faculty member","width":382},{"text":"assistant programming senior professor five minutes to find the problem with this","width":477},{"text":"and after three minutes neither of us had actually noticed the error yet","width":440},{"text":"so I'm pretty sure there's a problem with this but it took us more than 3 minutes to see it","width":286},{"text":"I'll give you a hint though, it does not satisfy mutual exclusion","width":385},{"text":"the question is how could that happen then?","width":397},{"text":"[silence]","width":12397},{"text":"okay, so, before we talk about this code in specifics, I find that it's absolutely fascinating the fact that we can write something that just has a couple of booleans, just flags, simple flags [something]","width":803},{"text":"and a simple switch variable and a little boolean that says your turn or my turn","width":287},{"text":"and we've built something that couldn't be much more complicated and it completely fails to be handled by our poor little brain","width":602},{"text":"we have a really really hard analyzing this really really simple code","width":289},{"text":"for spotting it for synchronization problems","width":209},{"text":"and concurrency bugs","width":135},{"text":"so, anyways, let's see if we can kind of walk through this and do it carefully","width":364},{"text":"let's suppose for example right now that only one thread kept on using the resource, use this critical section here","width":506},{"text":"can we have progress? right so if we only have one raise my flag!","width":520},{"text":"wooohooo, if your flag is raised, it's not, great! I don't need to wait, I can continue to my critical section and I'm going to set turn to you","width":636},{"text":"okay, do I have a turn variable? yes here's my turn, wooo!","width":290},{"text":"right and lower my flag","width":107},{"text":"okay right a millisecond later, I want to do some more stuff for this critical section so what do I do?","width":273},{"text":"raise my flag! is your flag raised? no [something over there] right great","width":240},{"text":"so I don't need to wait, I can enter my critical section, I'm going to again set the turn to you and lower my flag","width":412},{"text":"so that seems to work, I'm able to enter the critical section if no one else is using it so progress is good","width":558},{"text":"right mutual exclusion let's see if we can argue that it works and then we'll argue that it doesn't","width":495},{"text":"right so raise my flag and is your flag raised? then if it's not I'm going to continue to the critical section","width":659},{"text":"meanwhile another thread comes along. alright so","width":357},{"text":"[noise]","width":260},{"text":"there's my flag, right. another thread comes along and says oh um I see your flag is raised","width":794},{"text":"then I'm going to just wait until it's my turn","width":209},{"text":"eventually that other code finishes and passes the golden chalice, this turn, to me!","width":504},{"text":"so now I can continue","width":165},{"text":"but they are only going to pass the turn variable to me when it finished, so the code works! right?","width":508},{"text":"oh what happy little brains we have","width":208},{"text":"because we're so happy excited to see that our code works","width":206},{"text":"um, no, it doesn't work","width":249},{"text":"the way to analyze this is to say okay I've got this turn variable so I actually have to do this analysis twice","width":305},{"text":"I have to say suppose the turn variable was set to the first thread before this stuff started","width":319},{"text":"or suppose the turn variable was set to the other thread","width":310},{"text":"before this mess continued","width":121},{"text":"and if you do that, then it is possible to break mutual exclusion here's how then","width":531},{"text":"first of all we'll set turn equal to two","width":233},{"text":"so there was some prior instance when we'd run through this code and turn ended up being 2","width":320}]