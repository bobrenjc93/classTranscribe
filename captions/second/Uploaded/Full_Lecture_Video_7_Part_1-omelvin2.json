[{"text":"Alright, so, this little function can say initially we are going to just sleep for one second","width":566.1818182468414},{"text":"and then put something like \"HI!\".","width":263.18181824684143},{"text":"Ok, right, so its gonna print \"HI!\"","width":192.18181824684143},{"text":"So, now, I've got a program that is going to use two CPU's, if I have two CPU's.","width":535.1818182468414},{"text":"Uh oh, what happens if I only have one CPU?","width":365.18181824684143},{"text":"The scheduler!  The Linux Kernel is going to say \"okay, you get access to the CPU for say 10 milliseconds or 100 milliseconds","width":651.1818182468414},{"text":"and after that amount of time, I'm going to take you off the CPU and let the other thread use it.","width":378.18181824684143},{"text":"And if we do this faster enough, like 10 milliseconds or so","width":226.18181824684143},{"text":"then those slow humans will never notice, that actually only one thread at a time is on each CPU core","width":583.1818182468414},{"text":"And if it turns out that you make a system call like \"open\" or \"read\" and it takes time for us to read that stuff from the disk","width":455.18181824684143},{"text":"Then you don't need the CPU because you are waiting for stuff so I can give the CPU to someone else.","width":265.18181824684143},{"text":"So the scheduler has to make those decisions and make them well.","width":183.18181824684143},{"text":"Ok, so for example this sleep, you don't need any CPU to sleep.  I can let another thread use that.","width":454.18181824684143},{"text":"So, what were we going to do here...","width":162.18181824684143},{"text":"Oh yes, let's change this so we can cancel our little \"HI\" function.","width":273.18181824684143},{"text":"We'll sleep for 3 seconds here and then change to something like \"please_stop\".","width":495.18181824684143},{"text":"And then I will just loop forever.","width":228.18181824684143},{"text":"So, what do were want to do here?  We want to say \"while (!please_stop)\" keep going around.","width":404.18181824684143},{"text":"And finally, let's have a global variable...there we go.","width":281.18181824684143},{"text":"We know in C that our global variables are initialized to zero.","width":239.18181824684143},{"text":"Let's run this and see what mistakes we made.","width":128.18181824684143},{"text":"(waiting)","width":642.1818182468414},{"text":"Ok, alright.  Whoops, we didn't declare the thread id.  So, what's that?  \"pthread_id\" I believe.","width":512.1818182468414},{"text":"(waiting)","width":869.1818182468414},{"text":"(grumbling)","width":113.18181824684143},{"text":"","width":218.18181824684143},{"text":"Oh, I just put a \"t\"","width":181.18181824684143},{"text":"","width":227.18181824684143},{"text":"How about that?","width":71.18181824684143},{"text":"","width":284.18181824684143},{"text":"Yay!.  Ok, alright.","width":127.18181824684143},{"text":"","width":54.18181824684143},{"text":"So we print \"HI!\".  Our main thread sleeps for a bit and then calls \"please_stop\"","width":409.18181824684143},{"text":"And our little thread that is going around the loop says \"oh, look at that global variable, I better stop\".","width":224.18181824684143},{"text":"Now I use global variables for a quick demonstration. Obviously we could put that inside a struct.","width":257.18181824684143},{"text":"We could pass something to the working thread inside here and we could use that to communicate with the other struct","width":653.1818182468414},{"text":"so we could have some control if we agree to share some memory.","width":256.18181824684143},{"text":"","width":90.18181824684143},{"text":"Now I can hear my CPU fan going.","width":173.18181824684143},{"text":"(fan noises)","width":117.18181824684143},{"text":"Do you hear that?  Good.","width":213.18181824684143},{"text":"Because the CPU is constantly doing that little while loop in the main thread.","width":230.18181824684143},{"text":"So let's do something better than that.","width":232.18181824684143},{"text":"","width":3.1818182468414298},{"text":"What we would like to do of course is wait for the other thread to finish.","width":252.18181824684143},{"text":"One way to do that is to say \"pthread_join\" and say \"here is the thread that we want to finished\"","width":370.18181824684143},{"text":"And we would like to know it's exit value.","width":197.18181824684143},{"text":"There we go.  We can find out what it is.","width":153.18181824684143},{"text":"Alright, here is my exit value and we can say return something here","width":588.1818182468414},{"text":"So what when we call \"pthread_join\" again, this second thread is going to not require anymore CPU time.","width":441.18181824684143},{"text":"Because not it is waiting for the other thread to exit.","width":256.18181824684143},{"text":"","width":398.18181824684143},{"text":"So that is one way to write this program.","width":127.18181824684143},{"text":"","width":153.18181824684143},{"text":"I can also talk about \"pthread_exit\"","width":642.1818182468414},{"text":"Let's write a very dangerous program.","width":196.18181824684143},{"text":"This is the \"_killer_monsters_take_over_the_world\".","width":782.1818182468414},{"text":"You will agree that we probably should not run that function, yes?","width":373.18181824684143},{"text":"Well that's okay, because I am going to call pthread_exit before it.","width":497.18181824684143},{"text":"And I do not need a return value.","width":237.18181824684143},{"text":"\"pthread_exit()\" says \"hey, I am the chef and I am done.  I'm leaving the kitchen for good\".","width":615.1818182468414},{"text":"If you call pthread_exit then, you are saying \"this is the thread's return value\" and no more code will be run by that thread.","width":597.1818182468414},{"text":"\"_killer_monsters_take_over_the_world\" will never happen.","width":193.18181824684143},{"text":"","width":269.18181824684143},{"text":"This stuff about having \"exitvalue\" and \"pthread_join\" in this case, that is never going to happen.","width":437.18181824684143},{"text":"\"pthread_exit()\" simply means \"I am done\".","width":323.18181824684143},{"text":"","width":20.18181824684143},{"text":"A little bit of knowledge for you, if you call \"pthread_exit()\" inside the main thread, the original thread, like we did just did","width":561.1818182468414},{"text":"the rest of the process will actually keep on running.","width":193.18181824684143},{"text":"The pthread library actually says \"you know what?  I am actually not going to quit this process immediately","width":227.18181824684143},{"text":"I am going to wait until ALL threads have finished\".","width":255.18181824684143},{"text":"","width":326.18181824684143},{"text":"Let's prove that.  Let's call \"pthread_exit()\" here.","width":320.18181824684143},{"text":"","width":89.18181824684143},{"text":"I'm going to comment this out so it compiles.","width":193.18181824684143},{"text":"","width":163.18181824684143},{"text":"Instead I will call ... nah, this is good.","width":514.1818182468414},{"text":"So then, what will my program do now?","width":320.18181824684143},{"text":"","width":200.18181824684143},{"text":"That's right, it is just going to keep printing \"HI!\".","width":146.18181824684143},{"text":"It is not going to take over the world.","width":283.18181824684143},{"text":"Instead what we did is we created another thread and our main thread exited.","width":448.18181824684143},{"text":"","width":254.18181824684143},{"text":"So, let's go back to this.","width":128.18181824684143},{"text":"","width":157.18181824684143},{"text":"Let's answer some of these questions.","width":143.18181824684143},{"text":"What is the difference between exit and pthread_exit?","width":191.18181824684143},{"text":"What does exit do?","width":260.18181824684143},{"text":"It kills the whole process.","width":75.18181824684143},{"text":"Yes, it says \"Hey, this process is done and here's the exit value.","width":380.18181824684143},{"text":"By the way, it also does a little few extra things for you.","width":195.18181824684143},{"text":"If you've written to the C output buffers, like stdout and stderr or anything else","width":303.18181824684143},{"text":"those get flushed and those file streams get closed for you.","width":192.18181824684143},{"text":"","width":420.18181824684143},{"text":"So if you call exit, all of your threads are gone.","width":353.18181824684143},{"text":"\"We're done\"","width":232.18181824684143},{"text":"Your process is done.  And it doesn't matter which pthread calls exit().","width":382.18181824684143},{"text":"You are saying \"This whole process is done. Wrap up the shop, close all of the kitchens.  We're gone.\"","width":390.18181824684143}]