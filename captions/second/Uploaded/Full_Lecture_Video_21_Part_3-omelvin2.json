[{"text":"now we're only going to see this for slow running potentially blocking calls","width":613.1818182468414},{"text":"so things like semwait reading and writing to the network","width":372.18181824684143},{"text":"but it's important to handle this stuff well, otherwise","width":258.18181824684143},{"text":"your code will get to what we tested but in real situations it will then fail","width":388.18181824684143},{"text":"and imagine playing kind of russian roulette with your code","width":228.18181824684143},{"text":"I tell you what, just for fun we'll make sure one of the calls you make today is not going to work","width":307.18181824684143},{"text":"do you still feel lucky punk?","width":171.18181824684143},{"text":"so that's the purpose of this EINTR, it's to say oh look these thing were interrupted, we better call them again","width":578.1818182468414},{"text":"so let's see what the kind of code would look like in this case","width":270.18181824684143},{"text":"we'll make a call like semwait","width":603.1818182468414},{"text":"and we need to check to see if it failed","width":263.18181824684143},{"text":"okay how do I do that?","width":422.18181824684143},{"text":"you could say was its return value equal to negative one?","width":513.1818182468414},{"text":"right so if that's true, we know there was an error","width":483.18181824684143},{"text":"so let's find out if the error was hey I've got interrupted","width":1102.1818182468414},{"text":"if that's true, hey we'll go again","width":127.18181824684143},{"text":"right so here's our plan","width":358.18181824684143},{"text":"while this is true...","width":353.18181824684143},{"text":"go again!","width":73.18181824684143},{"text":"alright so perhaps you and your neighbor can tell me what's wrong with that code","width":256.18181824684143},{"text":"[silence]","width":1259.1818182468414},{"text":"so I'll give you a clue, what's an equals sign between friends?","width":913.1818182468414},{"text":"the worse thing about this error is that you get to see this kind of pattern right?","width":304.18181824684143},{"text":"you see this kind of code and you immediately say oh that's just calling sem_wait inside a while loop","width":272.18181824684143},{"text":"it's trying to be robust code, and you don't bother of course to actually read it","width":252.18181824684143},{"text":"so what are we doing here? well errno is settable, it behaves just like an integer and so we're just setting it","width":624.1818182468414},{"text":"so what's the result of this expression?","width":159.18181824684143},{"text":"a non-zero value so therefore it's true","width":261.18181824684143},{"text":"so what our code does then is say rather than check to see if it's equal to EINTR we just set the value to EINTR","width":683.1818182468414},{"text":"and so we go around again","width":93.18181824684143},{"text":"right so what effect would this have on the code?","width":348.18181824684143},{"text":"would you spot this error?","width":173.18181824684143},{"text":"when would it do bad things for you?","width":525.1818182468414},{"text":"thank you yes, if sem_wait failed for other reasons","width":265.18181824684143},{"text":"so for example, suppose you forgot to initialize the semaphore or you're running this on a system that doesn't support semaphores","width":522.1818182468414},{"text":"sem_wait might return a different message","width":379.18181824684143},{"text":"so what do you do? you call it again!","width":177.18181824684143},{"text":"it behaves exactly like a semaphore, it doesn't proceed, it just keeps on going around this loop forever","width":498.18181824684143},{"text":"and then you say ahhhhh why is this not working? right so be careful about that, watch out for your equal vs that","width":537.1818182468414},{"text":"so that is kind of a typical pattern","width":169.18181824684143},{"text":"sometimes you see a little bit more to this as well","width":201.18181824684143},{"text":"sometimes you see that actually we want to know say the number of bytes read","width":264.18181824684143},{"text":"so we might write something like this","width":170.18181824684143},{"text":"while negative one equals okay let's store the value of our return call so let's say we want to know the result of calling read","width":807.1818182468414},{"text":"blah blah blah blah blah alright","width":244.18181824684143},{"text":"and errno equals EINTR","width":948.1818182468414},{"text":"so now I'm assigning the value of read to my result so I can use that later inside the code","width":598.1818182468414},{"text":"perhaps I want to know for example if this is zero","width":185.18181824684143},{"text":"or the number of bytes that read managed to perform","width":303.18181824684143},{"text":"so if you were to drill down into the C library you would discover this kind of implementation","width":370.18181824684143},{"text":"that every time we make a system call, we potentially have to check to see whether it was interrupted or not","width":448.18181824684143},{"text":"for CS241 exams, unless I specifically ask you to write code that does this checking, I'm not going to expect anybody to have to write this full length out","width":614.1818182468414},{"text":"but put this in the back of your mind for the day that you're actually writing real system code outside a class","width":622.1818182468414},{"text":"questions? yes?","width":456.18181824684143},{"text":"aha, right","width":212.18181824684143},{"text":"so this normally happens when a signal comes in and your process has to process the signal","width":408.18181824684143},{"text":"but that could be anything, that could be a child finishing for example","width":477.18181824684143},{"text":"you might have noticed in some of the earlier programs we wrote that if you had a sleep and a SIGCHILD happened, the sleep itself could be interrupted","width":823.1818182468414},{"text":"so why is this? the short answer is that it makes operating system programming easier","width":579.1818182468414},{"text":"remember how I said that when we have to process a signal interrupt, we steal the CPU and we actually run some code for a moment","width":643.1818182468414},{"text":"and then we give the CPU back as if nothing happened","width":161.18181824684143},{"text":"well as you can see, it's not quite true","width":162.18181824684143},{"text":"actually as part of giving the CPU back, we just give up","width":304.18181824684143},{"text":"we say hey you know that system call I was trying to do, ha, I just gave up","width":351.18181824684143},{"text":"it's a nice day, I don't have a problem with that. do you?","width":398.18181824684143},{"text":"it's kind of like the californian hello, hello yes let's do lunch and not really","width":503.18181824684143},{"text":"so in making the design of the operating system easier, we've actually put the onus on systems programmers on our user code","width":584.1818182468414},{"text":"to actually deal with handling these interrupts, with failing system calls","width":893.1818182468414},{"text":"so fantastic, you actually now know a lot about how to actually write much more robust code by checking errno ","width":393.18181824684143},{"text":"by knowing that you have to potentially check this EINTR thing","width":288.18181824684143},{"text":"there's a bit more to say I'll let you read it on the wiki book as you usual","width":345.18181824684143},{"text":"but I'm not going to be writing this code all the time in future examples","width":574.1818182468414},{"text":"are you ready? page 2!","width":293.18181824684143}]