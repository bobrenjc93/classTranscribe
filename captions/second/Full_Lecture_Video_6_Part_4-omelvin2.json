[{"text":"OK. So, programmers took inspiration from miners.","width":403.18181824684143},{"text":"When you go down in the mine you take a canary, yes?","width":185.18181824684143},{"text":"The nice thing about canaries is they die before you, if there's poison gasses.","width":343.18181824684143},{"text":"Or at least then they stop singing as all is well.","width":164.18181824684143},{"text":"So here's what we can do. We can actually put some values into our heap barrier.","width":433.18181824684143},{"text":"And then we just check that those values are still correct.","width":172.18181824684143},{"text":"like there special hexidecimal values, like deadbeef, deadcode, or a value that is a quick hash of the values we want to store.","width":643.1818182468414},{"text":"So we can at least verify that things haven't been overwritten.","width":254.18181824684143},{"text":"So debug versions of malloc and free will do this. They'll take some extra space to write begging and endpoints.","width":473.18181824684143},{"text":"And then before they do anything, they'll check those values to see if they've been overwritten.","width":453.18181824684143},{"text":"So we can't stop the override, but we can at least detect it afterwards.","width":567.1818182468414},{"text":"Any questions?","width":435.18181824684143},{"text":"By the way this idea of putting the size inside as part of the allocated area, this was developed by, I think, Donald Knuth, many years ago.","width":835.1818182468414},{"text":"We've been living inside the user process. Now let's step back a moment and talk about virtual memory.","width":610.1818182468414},{"text":"What do we mean by virtual memory? We've virtualized memory. Ok, what do we mean by that?","width":229.18181824684143},{"text":"We mean that the addresses that our processes uses can have very little connection with the actual addresses that the RAM sees.","width":725.1818182468414},{"text":"That, in essence, there's a mapping.","width":219.18181824684143},{"text":"So ya, we can keep talking about the process address space.","width":200.18181824684143},{"text":"It goes from zero up to some high number, let's say 7fffffff.","width":310.18181824684143},{"text":"And we can think of it in terms of little blocks.","width":143.18181824684143},{"text":"And in fact, our virtual memory likes to work with pages called, and there typically about 4096 bytes, or 4k","width":666.1818182468414},{"text":"So, anytime you read or write into your virtual memory, we've got to take that address.","width":653.1818182468414},{"text":"Some magic happens.","width":217.18181824684143},{"text":"And say ok, which piece of RAM, which physical address, should I read or write to?","width":785.1818182468414},{"text":"This side will have virtual memory, and and this side we have real addresses.","width":730.1818182468414},{"text":"And it's the MMU, the Memory Management Unit, that has to convert one to the other.","width":530.1818182468414},{"text":"Now today we're just doing the quick two minute version, because there's a lot more to say about this","width":316.18181824684143},{"text":"I just want to give you an idea we can actually step outside the matrix.","width":248.18181824684143},{"text":"Once we start playing these tricks, there's some amazing things we can do with this, as system programmers.","width":608.1818182468414},{"text":"This is a fundamental piece of any reasonable hardware that runs a modern operating system will have a memory management unit,","width":698.1818182468414},{"text":"in order to convert virtual memories into physical addresses.","width":195.18181824684143},{"text":"And here's the cool thing is that now these don't need to be contiguous.","width":284.18181824684143},{"text":"That this mapping can be all over the place.","width":254.18181824684143},{"text":"So this 4K can go to some lower memory and this 4K can go to some other piece of RAM.","width":422.18181824684143},{"text":"So this allows us to use our physical memory much more efficiently.","width":307.18181824684143},{"text":"We don't have to worry about fragmentation, now, and having holes or having spaces inside our physical memory that we can't use.","width":670.1818182468414},{"text":"[So if it's stored on the hard drive...] Ah yes, I wasn't going to mention that but ya.","width":181.18181824684143},{"text":"Here's the cool thing is that now we can now say to every process, \"Hey! you want 4GB? No problem!\"","width":264.18181824684143},{"text":"\"You want 4GB? No problem! You want 16GB? No problem!\" Ok my machine only has 1GB but don't tell them.","width":444.18181824684143},{"text":"Because what we can do is, ya, we can actually secretly store some of the information they want on the hard drive.","width":508.18181824684143},{"text":"It's basically like this, imagine only the bits of the world your currently looking at exist.","width":457.18181824684143},{"text":"Any time you turn around and look behind you, I'm going to put you on pause and quickly recreate everything that you intended to look at.","width":563.1818182468414},{"text":"When I finish doing that, I'll release you again.","width":243.18181824684143},{"text":"So that's what the virtual memory, that's what the operating system does for you.","width":273.18181824684143},{"text":"You think you got 4GB of space. I just promised you that.","width":359.18181824684143},{"text":"Promises are easy because I know you can't actually look at it all at the same time.","width":313.18181824684143},{"text":"I'm going to intercept any time you try to read or write memory to make sure that what you're trying to read or write actually appears to be there inside RAM.","width":473.18181824684143},{"text":"But it's all conjuring. It's all fake. And it's up to the operating system to do this for your process and any other process that's currently running.","width":776.1818182468414},{"text":"Right, that's enough of virtual memory today.","width":333.18181824684143},{"text":"But it's a wonderful system. It's one of the best parts of an operating system today, I believe.","width":353.18181824684143},{"text":"Instead, let's talk about something which is just as powerful and is going to separate your programs from mere novice programmers.","width":863.1818182468414},{"text":"And that is being able to use threads effectively.","width":152.18181824684143},{"text":"This is the beginnings of the major part of this course here, is to understand how to work with synchronization and work with multiple threads. ","width":493.18181824684143},{"text":"This is the coolest bit so here we go.","width":315.18181824684143},{"text":"Let's put on some basic ideas here.","width":202.18181824684143},{"text":"How many heaps does a process have?","width":344.18181824684143},{"text":"That was easy. One.","width":151.18181824684143},{"text":"Inside your process memory a heap is used for all those malloc and free calls and there's only one heap. ","width":641.1818182468414},{"text":"So it's just a BIG area of space that anytime you want memory from you can just call malloc, or calloc or realloc.","width":418.18181824684143},{"text":"But you can just say \"Hey I need some memory and this is how many bytes I need.","width":178.18181824684143},{"text":"It's stored in the heap.","width":330.18181824684143},{"text":"How many stacks?","width":110.18181824684143},{"text":"When we first introduced our program modal we had just one","width":223.18181824684143},{"text":"We said, \"What's a stack?\"  Well, anytime you call a function I need some space for those automatic temporary variables","width":398.18181824684143},{"text":"And also a bit of space to say where the CPU should go back to when it finishes calculating anything we need to do inside that function.","width":470.18181824684143},{"text":"And if the function is recursive then my stack is going to get lower, bigger and bigger, because I'm going to keep calling myself and I need more space on the stack.","width":510.18181824684143},{"text":"And if my function calls other functions, ya agian, my stack is going to get bigger.","width":297.18181824684143},{"text":"That's a stack.","width":266.18181824684143},{"text":"What if I had two CPUs working inside my process at the same time?","width":609.1818182468414},{"text":"Each one needs a stack. Yes?","width":187.18181824684143},{"text":"Because each one will be inside a function; that function might be calling things.","width":331.18181824684143}]