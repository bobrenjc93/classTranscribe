[{"text":"so what is result pointing to?","width":560.1818182468414},{"text":"could be anything","width":96.18181824684143},{"text":"right? we just made this little thing on the stack","width":173.18181824684143},{"text":"its just whatever happened to be at the stack memory at that moment","width":212.18181824684143},{"text":"so we just called free on a arbitrary block of memory","width":258.18181824684143},{"text":"whoops","width":152.18181824684143},{"text":"our program is probably gonna crash","width":106.18181824684143},{"text":"at this point","width":62.18181824684143},{"text":"but its certainly probably vulnerable to other attacks at this point","width":259.18181824684143},{"text":"ok so how should we fix this?","width":127.18181824684143},{"text":"well here's what i would do","width":66.18181824684143},{"text":"i will probably set this to null to begin with","width":165.18181824684143},{"text":"and let me check, I'll only called this if the result has been changed","width":686.1818182468414},{"text":"so if its not equal to null","width":93.18181824684143},{"text":"then call freeaddrinfo","width":94.18181824684143},{"text":"that's a more robust program","width":272.18181824684143},{"text":"right","width":308.18181824684143},{"text":"port hijacking","width":167.18181824684143},{"text":"so","width":133.18181824684143},{"text":"i love this i want to dress up as a highway man as a pirate","width":294.18181824684143},{"text":"yes! there's a potential for port hijacking when we write our server programs","width":394.18181824684143},{"text":"imagine this, imagine you write a fantastic web server","width":188.18181824684143},{"text":"or another program that uses sockets to communicate","width":277.18181824684143},{"text":"and then your program finishes, perhaps it crashes","width":335.18181824684143},{"text":"at that precise moment, another process starts listening to the same port","width":335.18181824684143},{"text":"mua hahaha... and it gets some bytes","width":229.18181824684143},{"text":"that were intended for yoyu","width":235.18181824684143},{"text":"well this is a security risk","width":71.18181824684143},{"text":"we should prevent this, right","width":58.18181824684143},{"text":"we should prevent another process from immediately starting up","width":312.18181824684143},{"text":"and so that actually led to a socket rule where if you claimed a particular port, another process can't immediately reuse it","width":874.1818182468414},{"text":"if that process belongs to another user, we have a longer time out","width":423.18181824684143},{"text":"let's actually see this as a little demo","width":259.18181824684143},{"text":"and then we'll say what we can do","width":128.18181824684143},{"text":"uhh ... where is it... alright... so","width":1201.1818182468414},{"text":"ok, right, good","width":58.18181824684143},{"text":"i have a program here. so now let's run my little server here","width":277.18181824684143},{"text":"ok so gcc server1.c","width":374.18181824684143},{"text":"alright, so here's a little program we service for where we waiting on accept waiting for connection","width":485.18181824684143},{"text":"right, so let me connect to this. i'll start a new window, ","width":323.18181824684143},{"text":"and is today i'll use nightcat , so nc localhost 1234 ","width":414.18181824684143},{"text":"okay, we've connected. Yes!","width":121.18181824684143},{"text":"it's good! so I can send something over here","width":246.18181824684143},{"text":"let me at this point quit my program, i'll make a few changes, and i'll run it again. ","width":369.18181824684143},{"text":"oops. bind failed","width":115.18181824684143},{"text":"address already in use. ","width":81.18181824684143},{"text":"I couldn't reuse that port","width":258.18181824684143},{"text":"so that port for little while is still being bound to that old process","width":454.18181824684143},{"text":"even though the old process is quit, we couldn't immediately reuse it. ","width":311.18181824684143},{"text":"okay, so what can we do as developers?","width":206.18181824684143},{"text":"uh we like to be able to reuse our programs","width":127.18181824684143},{"text":"so i'll test it quickly","width":128.18181824684143},{"text":"[gibberish]","width":72.18181824684143},{"text":"it's okay I can reuse my port 1234 again","width":230.18181824684143},{"text":"so what options is to use","width":77.18181824684143},{"text":"hey, dont develop too fast","width":243.18181824684143},{"text":"but no we can do a bit better than that","width":103.18181824684143},{"text":"we can actually disable this security feature","width":239.18181824684143},{"text":"by setting an option on the sockets","width":137.18181824684143},{"text":"so lets see how we can do that","width":171.18181824684143},{"text":"hello ... just trying to connect to my machine right, my machine. so","width":265.18181824684143},{"text":"let's see what we can do here","width":118.18181824684143},{"text":"and there's a little option called setsocketopt","width":259.18181824684143},{"text":"where, make this larger, where ... on my server socket, i can say i wanna be able to reuse the port in the future","width":927.1818182468414},{"text":"so if you set this option on the port, that this when your process dies, or quits, another process can immediately reuse the same port","width":641.1818182468414},{"text":"okay. some odd syntax. we are gonna see this in a bit more examples. ","width":302.18181824684143},{"text":"of this. ","width":49.18181824684143},{"text":"is that youll see that we have to , in this case, pass in the address of the integer value, and then the size of an int","width":921.1818182468414},{"text":"so we are gonna see this passing a couple time today when we pass in the addresses of something and size of the thing that we are trying to pass in","width":479.18181824684143},{"text":"but thats just a bit kind of useful line of code that youll be using in one of the later mps","width":407.18181824684143},{"text":"one of the mps that we've got lined up for you is called wearable's mp, where we are going to simulate having a whole load of devices talking to, say, a server, so you might have to watch, you might have a pace maker, you might have a, i dont know, hair, that talks to your server ","width":1280.1818182468414},{"text":"and this is the single ... connecting and constantly talking to your server which collects your data, maybe collecting your blood pressure, and a whole load of your vital signs","width":543.1818182468414},{"text":"so ","width":70.18181824684143},{"text":"we want a server when we developing these stuff we wanna be able to quickly reuse ports, so here's the option to do that","width":451.18181824684143},{"text":"okay, so let's make a note of this","width":267.18181824684143},{"text":"how do i do this? if we start our programs and we use the same port, easy, we gonna use setsockopt and the magic ... is this SO_REUSEPORT thing","width":1221.1818182468414},{"text":"which should be in the wikibook. If not, I would add it","width":284.18181824684143},{"text":"and notice we do this before we call bind so we do this early on","width":356.18181824684143},{"text":"just after creating this socket","width":112.18181824684143},{"text":"set this option on on the socket","width":473.18181824684143},{"text":"right so we've played with very very simple kind of server, now you wanna do more. ","width":418.18181824684143},{"text":"right? this is uiuc, this is illinois of, university of illinois, we wanna go up to eleven. we don't wanna have just a single connection to a single client","width":657.1818182468414},{"text":"we actually want to write servers that can talk to thousands of clients at a time","width":401.18181824684143},{"text":"how can we do that?","width":119.18181824684143},{"text":"well, a long time ago, we realized that i dont want to always block on my read call waiting for my client to send me something, it would be nice to find out which client is coming talking to me","width":793.1818182468414},{"text":"has sent me some bytes","width":213.18181824684143},{"text":"so, the idea of select was born","width":287.18181824684143},{"text":"okay, right, so the very first implementation to attempt to making performance servers is to use the system call, is called select","width":859.1818182468414},{"text":"probably about 5 minutes after someone designed select, we discovered it wasn't any good. ","width":297.18181824684143}]