[{"text":"okay so here's our plan","width":330.18181824684143},{"text":"we're going to use something called","width":132.18181824684143},{"text":"mmap","width":113.18181824684143},{"text":"and when you say \"Hey, I want to map some virtual memory\"","width":423.18181824684143},{"text":"we need to say","width":140.18181824684143},{"text":"what kind of memory do we want?","width":96.18181824684143},{"text":"do we want memory that is readable?","width":174.18181824684143},{"text":"writable? or executable?","width":150.18181824684143},{"text":"some combination of the above?","width":254.18181824684143},{"text":"so typically we will want at least read and write access","width":293.18181824684143},{"text":"so here's our protection","width":331.18181824684143},{"text":"so this is how, if you","width":120.18181824684143},{"text":"if your process tried to, say, change a byte of libc","width":417.18181824684143},{"text":"the virtual memory hardware would say \"Hold on a moment! ","width":121.18181824684143},{"text":"you don't have write access to that file.","width":147.18181824684143},{"text":"I'm going to let you proceed any further\" and it would raise a signal","width":353.18181824684143},{"text":"but we want to do more than that","width":77.18181824684143},{"text":"we actually want to be able to modify the file","width":150.18181824684143},{"text":"and we're going to actually change the contents","width":216.18181824684143},{"text":"of our file just by writing into memory","width":237.18181824684143},{"text":"which I think is pretty cool","width":256.18181824684143},{"text":"the other thing we're going to see is","width":101.18181824684143},{"text":"this map shared","width":170.18181824684143},{"text":"which means that changes we make","width":142.18181824684143},{"text":"are shared with the file","width":2790.1818182468414},{"text":"sudo change owner to be angrave","width":565.1818182468414},{"text":"run vim, great","width":310.18181824684143},{"text":"now, there's a gotcha with using mmap","width":202.18181824684143},{"text":"which is that it's not going to automatically extend the file for us","width":227.18181824684143},{"text":"so if want to be able to, say, store a few integers","width":219.18181824684143},{"text":"in our memory-mapped space","width":91.18181824684143},{"text":"then we better make sure that our file is big enough before-hand","width":264.18181824684143},{"text":"so let's do that","width":294.18181824684143},{"text":"first let me look at a file descriptor","width":122.18181824684143},{"text":"and I'll open the file called data","width":106.18181824684143},{"text":"I want read and write","width":97.18181824684143},{"text":"if it doesn't exist, I want to be able to create it","width":131.18181824684143},{"text":"if it does exist, I'm going to truncate it","width":135.18181824684143},{"text":"and here's my permission bits, 0600","width":163.18181824684143},{"text":"what does 0600 mean?","width":169.18181824684143},{"text":"the 0 and the beginning means I'm going to speak octal","width":177.18181824684143},{"text":"and the 6 means","width":189.18181824684143},{"text":"I want read and write permission","width":100.18181824684143},{"text":"and everyone else, ha! nothing for you","width":196.18181824684143},{"text":"we're making this a private file","width":174.18181824684143},{"text":"we need a way to be able to extend this file","width":276.18181824684143},{"text":"how can I do that?","width":520.1818182468414},{"text":"any ideas?","width":433.18181824684143},{"text":"how about using seek","width":183.18181824684143},{"text":"there's two ways to do this: we could have actually written enough bytes","width":217.18181824684143},{"text":"so we could have written size time size number of bytes into my file","width":330.18181824684143},{"text":"but another way do it is just to deliberately seek","width":222.18181824684143},{"text":"to a new end-point, and we'll write something in there","width":280.18181824684143},{"text":"so let's seek","width":169.18181824684143},{"text":"on my file descriptor","width":148.18181824684143},{"text":"who remembers how to use seek?","width":150.18181824684143},{"text":"I want to go this far into the file","width":117.18181824684143},{"text":"and remember we can like seek end","width":243.18181824684143},{"text":"seek beginning, we can say seek set","width":150.18181824684143},{"text":"and I'm going to write just one byte in here","width":160.18181824684143},{"text":"so let me write into my file descriptor","width":156.18181824684143},{"text":"here's a pointer to some data I want to send","width":124.18181824684143},{"text":"I'll just send, say, abc","width":190.18181824684143},{"text":"and I'll send those three bytes","width":136.18181824684143},{"text":"and in doing that, I've made sure that","width":93.18181824684143},{"text":"my file is more than","width":218.18181824684143},{"text":"this size","width":72.18181824684143},{"text":"so that's just the easiest way of","width":182.18181824684143},{"text":"extending the size of a file","width":137.18181824684143},{"text":"now we do our map","width":143.18181824684143},{"text":"and if it works, we get back a valid address","width":758.1818182468414},{"text":"for now","width":172.18181824684143},{"text":"I can treat that address","width":122.18181824684143},{"text":"as some memory that I can now use","width":151.18181824684143},{"text":"so I'm going to write into","width":204.18181824684143},{"text":"my memory","width":123.18181824684143},{"text":"12345678","width":95.18181824684143},{"text":"and this other hexidecimal constant called dead code","width":348.18181824684143},{"text":"to make sure that","width":193.18181824684143},{"text":"the changes in memory are","width":289.18181824684143},{"text":"written back to the file after","width":93.18181824684143},{"text":"I should unmap it, so how do I do that?","width":113.18181824684143},{"text":"I call munmap and we're done","width":249.18181824684143},{"text":"so let's compile this","width":1640.1818182468414},{"text":"undefined reference to seek","width":203.18181824684143},{"text":"what did we do wrong there?","width":1148.1818182468414},{"text":"sudo chmod angrave","width":384.18181824684143},{"text":"everything","width":63.18181824684143}]