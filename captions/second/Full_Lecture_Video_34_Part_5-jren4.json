[{"text":"so our task then was to turn this into a merge sort problem","width":473},{"text":"in other words..","width":219},{"text":"that two neighboring chunks of data","width":284},{"text":"should be combined","width":122},{"text":"each individual chunk was sorted using queuesort","width":267},{"text":"and we had say eight threads available to start doing all this merging","width":552},{"text":"now the naive TAs solution was actually not that hard to beat","width":421},{"text":"here's all it did","width":206},{"text":"it simply copied all of these into a large array","width":268},{"text":"and we made a fair guess about how big a size it should be","width":285},{"text":"but we did use realloc just in case the data was going to be larger than expected","width":389},{"text":"but we didn't start off with something small like hey 16 or 32","width":234},{"text":"we gave it a big number because if realloc does need to realloc for space","width":393},{"text":"then it used to call malloc, it needs to then do a memcpy to move all of that data","width":323},{"text":"and talking to memory is slow so we made a good guesstimate about how big a buffer we would need","width":493},{"text":"it simply waited until we got all the pieces","width":319},{"text":"and then it used the part one code","width":391},{"text":"and then it printed out the whole result","width":555},{"text":"right how can we do better?","width":376},{"text":"in this regrade of this we're actually going to put in a small delay between each one to assure that there's actually some significant computational time to work on these items","width":773},{"text":"so some things that we can do which are better, obviously we've got 8 threads we could get started sorting this data before we see the very last piece of data","width":635},{"text":"the other thing we can do is at the very end","width":265},{"text":"we could actually start printing the results","width":254},{"text":"before we finished the final merge","width":289},{"text":"so in the very final merge, as we're pulling these two yellow pieces together","width":342},{"text":"if I got to here, I don't even need to write this data back I could be printing it out to a file","width":605},{"text":"as I merge these results together, so there's actually two optimization ideas","width":384},{"text":"right so what's the simplest way of doing some of these early merges","width":296},{"text":"well one is to say hey doing this stuff thinking about all these different levels is really really complicated","width":398},{"text":"for my tired brain","width":176},{"text":"and so get something simple working, here's a really simple idea","width":312},{"text":"is look at these in pairs","width":167},{"text":"look a lot of merging actually just takes down here at the smallest level","width":333},{"text":"so we could get some speed up","width":172},{"text":"just by thinking about these small blocks","width":258},{"text":"right so every time I see an odd numbered block, I'm going to start off the merge process to make myself a bigger block","width":640},{"text":"and so I could probably write that code just to deal with these smaller blocks","width":257},{"text":"the accounting, keeping track of all the statuses of these little blocks is not too hard","width":448},{"text":"and then when I finish making all of my lighter blue, my cyan blocks, then I'll just...","width":395},{"text":"give the rest of the problem to my original part1 code and just let it run through that","width":604},{"text":"right I should probably stop here because unfortunately...","width":373},{"text":"you are all two bright, you want to do better than this","width":318},{"text":"here's the danger, A writing C code is hard","width":196},{"text":"I'll give you an example of that on Friday when I talk about Toyota's C code and their embedded code inside their memory management unit","width":464},{"text":"various swear words have been defined to describe just what a mess this C code was","width":516},{"text":"so that's the first thing, look writing C code is hard, writing any code is hard","width":312},{"text":"second is that thinking about this algorithm is hard","width":267},{"text":"and sometimes it's good just to come up with something which","width":256},{"text":"you have high confidence in working, get that working and then have a go at something more complicated","width":538},{"text":"so I'll give you some hints about something that's a bit more complicated without going into a full algorithm","width":306},{"text":"and it's this","width":198},{"text":"let's label our blocks 0 1 2 3 4 you get the idea","width":581},{"text":"and also, we'll keep track of the blocks as to how much data they contain which is sorted","width":477},{"text":"so initially after we've done the queuesort I've got one block size of data","width":383},{"text":"and later up here I've got two block sizes of data","width":583},{"text":"so if I keep these labels","width":233},{"text":"then my labels correspond to where my blocks start in memory","width":234},{"text":"so let me call this block 0, this block 2, this block 4, this block 6","width":479},{"text":"if I do this, then I can make the following observation","width":280},{"text":"my block size gives me a strong hint to which pairs I should be merging together","width":685},{"text":"so for example, on my cyan here, if I gave you block 4, you could say oh you should be merging that with block 6","width":649},{"text":"if I gave you block 6, you could say oh you should be merging that with block 4 once they are of sufficient size","width":626},{"text":"so if I gave you a block 4 of size 2, you'd say okay great that needs to be merged with block 6 of size 2","width":385},{"text":"if block 6 of size 2 is not yet ready, then do nothing","width":410},{"text":"and we can go the other way, hey here's block 6 of size 2, you should merge with block 4 of size 2","width":388},{"text":"if block 4 of size 2 is not yet ready, do nothing, don't panic, don't worry about it because at some point block 4 will be ready in the future and it will merge with me","width":557}]