[{"text":"so your homework for this week is to go and upgrade please","width":256},{"text":"go and get one of those uiuc brains please","width":192},{"text":"um because this stuff is really hard, we're looking at one piece of code but thinking about it for what could happen when two different threads happen at the same time","width":576},{"text":"and you're thinking about the sad days, your thinking about what could possibly go wrong","width":448},{"text":"we're not thinking about oh my code works great, it's no no let's look at this really really critically","width":192},{"text":"yes so our problem would be if two threads came along called lock at the same time and they both read a value of zero for the lock value","width":640},{"text":"before either of them had a chance to change it to one","width":192},{"text":"not very likely but that's not good enough, we're trying to make code that actually works","width":384},{"text":"that doesn't make us lose money or corrupt our data structure","width":320},{"text":"[something] at the end there can only be one thread that gets through this","width":256},{"text":"alright I talk about threads because that's how we program this stuff","width":256},{"text":"but if you read the historic literature, it talks about processes that's because we're thinking about this actually in a more abstract sense","width":576},{"text":"not about pthreads and c structures but just how do we actually do this so that it works","width":512},{"text":"alright so this is broken, the only way that we could have made this code work is if we had somehow done all of this as kind of one operation","width":576},{"text":"but we can't do that","width":192},{"text":"in c","width":64},{"text":"you can't say okay I'm the gorilla, whilst I look at this lock, don't let anyone else look at it or touch it","width":512},{"text":"how do I do that? easy, make a lock, oh wait that's what I'm trying to do right?","width":192},{"text":"so that's not going to work for us","width":128},{"text":"okay so that failed, what we failed at was mutual exclusion","width":320},{"text":"we only want one thread or process if you're talking historically inside our critical section","width":768},{"text":"so let's try a different solution, let's try our first real candidate solution","width":1024},{"text":"we'll agree on the following","width":320},{"text":"now before you panic, the code written out here, the pseudocode is the same as the pseudocode on the right hand side","width":384},{"text":"the reason we wrote it twice is because I want you to think about two threads or two processes trying to execute this at the same time","width":384},{"text":"and see if we can actually kind of prevent bad things from happening","width":256},{"text":"so what we'll do is we'll have some flags","width":128},{"text":"we'll say look, I'm going to just wait until your flag is lowered","width":320},{"text":"and your thread will do the same","width":384},{"text":"so if I see that your flag is up, then I know that you are inside the critical section","width":704},{"text":"in which case I'm just going to wait","width":384},{"text":"once I decide that your flag is down, I'm going to raise my flag, I can do my stuff and then I'll lower my flag","width":640},{"text":"now we can say what happens if I have three or four or five or more threads in this, let's not","width":384},{"text":"let's just worry about what happens with just two threads or two processes trying to do that","width":320},{"text":"because this is hard enough with just two","width":64},{"text":"alright so does this work, does this suffer from the same problem?","width":320},{"text":"or not?","width":64},{"text":"okay you decide and see if you can argue it with your neighbor","width":320},{"text":"[silence]","width":3328},{"text":"okay so does it work? yes it does great, end of lecture","width":448},{"text":"no of course it doesn't work","width":64},{"text":"so does it work? no why not?","width":320},{"text":"let's hear from someone over here, yes","width":384},{"text":"they both could be waiting forever, uhhhhhhh, I think that might be hard, I think we can assume that their flags are initially down","width":1024},{"text":"alright so how will they get to have both of them up?","width":512},{"text":"come on keep going","width":64},{"text":"alright so we have a potential problem, yes that both people or both threads could see each other and say oh look his flag is down","width":1472},{"text":"great I can continue, at which point we raise our flag and say alright off I go","width":384},{"text":"and they do this at exactly the same time, or about the same time","width":256},{"text":"so hey i'm going to wait until your flag is lowered and I'm going to wait until your flag is lowered","width":576},{"text":"they check each others flags they are both low so they can both proceed","width":320},{"text":"they raise their flags to say okay I'm going in","width":192},{"text":"but it's too late, they've both gotten past this little loop","width":192},{"text":"so they both go into the critical section so what we have failed on the mutual exclusion principle game again","width":512},{"text":"we did not get mutual exclusion","width":256},{"text":"we wanted one person inside our critical section at a time thank you very much and we failed","width":384},{"text":"so when we're looking at these solutions, we've got to evaluate them a little bit carefully because it can happen more than once","width":512},{"text":"you could imagine you're going to wrap this around some data structure update like hey I want to add something to my linked list","width":448},{"text":"or add something to my hash","width":128},{"text":"and I don't know where I'm going to do it but I do know I'm going to say insert things into my hash or read my hash multiple times","width":448},{"text":"right so, let's be sneaky, let's be guided by what we did before","width":512},{"text":"and this time we're going to raise our flag first","width":192},{"text":"that way hopefully, we can stop this mutual exclusion problem","width":320},{"text":"okay what's wrong with this solution, right so again the code here is the same as this code here","width":448},{"text":"you could just imagine that this is person A and person A or thread A and thread B","width":192},{"text":"what happens now? what could possibly go wrong?","width":192},{"text":"again take a moment to argue this with your neighbor and even if you don't agree with them perhaps you can persuade them that you're right","width":512},{"text":"[silence]","width":1920}]