[{"text":"okay let me tell you how hard this example is","width":448},{"text":"forgive us when I wrote this little problem I challenged a faculty member","width":448},{"text":"assistant programming senior professor five minutes to find the problem with this","width":384},{"text":"and after three minutes neither of us had actually noticed the error yet","width":448},{"text":"so I'm pretty sure there's a problem with this but it took us more than 3 minutes to see it","width":384},{"text":"I'll give you a hint though, it does not satisfy mutual exclusion","width":256},{"text":"the question is how could that happen then?","width":256},{"text":"[silence]","width":12544},{"text":"okay before we talk about this code in specifics, I find that it's absolutely fascinating the fact that we can write something that just has a couple of booleans, just flags, simple flags","width":768},{"text":"and a simple switch variable and a little boolean that says your turn or my turn","width":448},{"text":"and we've got something that couldn't be much more complicated and it completely fails to be handled by our poor little brain","width":512},{"text":"we have a really really hard analyzing this really really simple code","width":256},{"text":"for spotting it for synchronization problems","width":256},{"text":"and concurrency bugs","width":64},{"text":"let's see if we can kind of walk through this and do it carefully","width":384},{"text":"let's suppose for example right now that only one thread kept on using the resource, use this critical section here","width":512},{"text":"can we have progress? right so if we only have one raise my flag!","width":384},{"text":"wooohooo, if your flag is raised, it's not, great! I don't need to wait, I can continue to my critical section and I'm going to set turn to you","width":896},{"text":"alright do I have a turn variable? yes here's my turn, wooo!","width":192},{"text":"right and lower my flag","width":128},{"text":"okay right and many seconds later I want to do some more stuff for this critical section so what do I do?","width":320},{"text":"raise my flag! is your flag raised? no [something over there] right great","width":128},{"text":"so I don't need to wait, I can enter my critical section, I'm going to again set the turn to you and lower my flag","width":512},{"text":"so that seems to work, I'm able to enter the critical section if no one else is using it so progress is good","width":448},{"text":"right mutual exclusion let's see if we can argue that it works and then we'll argue that it doesn't","width":576},{"text":"right so raise my flag and is your flag raised? then if it's not I'm going to continue to the critical section","width":704},{"text":"meanwhile another thread comes along","width":128},{"text":"[noise]","width":384},{"text":"ah there's my flag, right another thread comes along and says oh um I see your flag is raised","width":768},{"text":"then I'm going to just wait until it's my turn","width":320},{"text":"eventually that other code finishes and passes the golden chalice, this turn, to me!","width":448},{"text":"so now I can continue","width":128},{"text":"but they are only going to pass the turn variable to me when it finished, so the code works! right?","width":448},{"text":"oh what happy little brains we have","width":320},{"text":"because we're so happy excited to see that our code works","width":256},{"text":"no, it doesn't work","width":192},{"text":"the way to analyze this is to say okay I've got this turn variable so I actually have to do this analysis twice","width":448},{"text":"I have to say suppose the turn variable was set to the first thread before this stuff started","width":192},{"text":"or suppose the turn variable was set to the other thread","width":320},{"text":"before this mess continued","width":128},{"text":"and if you do that, then it is possible to break mutual exclusion here's how then","width":576},{"text":"first of all we'll set turn equal to two","width":192},{"text":"so there is some prior instance when we'd run through this code and turn ended up being 2","width":320}]