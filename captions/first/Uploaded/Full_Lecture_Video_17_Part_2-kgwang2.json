[{"text":"I have a story once about a ","width":5632},{"text":"A friend that got 200 applicants for one job, so","width":384},{"text":"The programmers, the software developers were saying \"ha! how do you deal with like this big stack of resumes?\"","width":512},{"text":"So the boss picked up exactly half the pile, put them in the trash, and said \"I don't like dealing with unlucky people.\"","width":384},{"text":"(laughter)","width":64},{"text":"Alright, so let's have a look at this code:","width":192},{"text":"Right, so","width":64},{"text":"Here's the plan, right: we know about circular wait, so","width":256},{"text":"What we're trying to do is, if we fail, we'll swap our ideas of left and rights and next time around the loop, we won't actually be picking up the fork on the left, we'll actually be picking up the fork on our right.","width":704},{"text":"And then we'll try to pick up the other one.","width":192},{"text":"And if that fails again,","width":128},{"text":"Well, we swap our ideas of left and right again","width":192},{"text":"And so we end up picking up on the left first, and then on the right.","width":192},{"text":"So, does this code work?","width":256},{"text":"If you're in your Google interview, and someone says \"okay, look at this code! Does it work?\"","width":704},{"text":"What would you say?","width":256},{"text":"\"Excuse me, I need to run back to CS 241!\"","width":192},{"text":"\"Can I make a phone a friend?\"","width":64},{"text":"Right, what do people think?","width":256},{"text":"I'm sorry","width":384},{"text":"Okay, it tries to break circular wait","width":192},{"text":"By not having a... by saying, \"okay, I'll pick up the other side first\"","width":320},{"text":"Alright","width":64},{"text":"True, this last kind of probably the thinking behind it this","width":256},{"text":"But...","width":64},{"text":"Does the code actually run? Will it deadlock ever, or are you confident this code will never deadlock?","width":384},{"text":"Remember, our understanding of this is not just about dining philosophers; it's about being able to write multithreaded code in general and spot problems.","width":512},{"text":"Yes?","width":64},{"text":"Yeah.","width":896},{"text":"So you, are you saying there is deadlock or not deadlock?","width":896},{"text":"So you're saying there's potential for livelock where one philosopher never gets to eat or two are constantly interchanging?","width":576},{"text":"Okay, I'll come back to that, I'll the point in a moment. Yes?","width":256},{"text":"Uh huh?","width":256},{"text":"Yep.","width":192},{"text":"So, when you say \"pthread_mutex_lock\" line at the same time, which lock line are you talking about?","width":896},{"text":"This one?","width":640},{"text":"Okay.","width":64},{"text":"Right.","width":128},{"text":"So","width":64},{"text":"Let's talk about the \"live lock\" thing, right.","width":384},{"text":"So","width":64},{"text":"Yes, and I'll come back to that. Right, so let's talk about the first question, right: could there be live-lock here?","width":384},{"text":"Alright, live-lock, remember, is when we don't have deadlock, our processes haven't actually just ground to a halt, waiting for an event; no, they're dancing around, trying to make progress, but they never actually make progress.","width":704},{"text":"They never actually are able to proceed, they're always saying, \"okay, can I take it now? Can I take it now?\"","width":384},{"text":"It's, it's like trying to make a continuous kind of phone calls and you're never actually getting through","width":384},{"text":"You're using up your, you're running your CPU program but it doesn't actually achieve what you want it to. So you still suffer from starvation.","width":384},{"text":"So, the code tries to prevent live-lock","width":448},{"text":"That's kind of the idea behind this \"tries_left\" thing.","width":128},{"text":"We don't want a philosopher to starve; if it kind of keeps trying to pick up one fork and it fails to pick up the second one, 'cuz our trylock says \"I'm sorry, another philosopher has already got it\"","width":832},{"text":"Eventually, the philosopher gets angry and says \"I'm not standing for this live-lock business. I don't wanna keep holding onto the left, picking up the right, letting go, picking up, letting go, picking up, letting go, picking...\" you know.","width":704},{"text":"\"This is not working out for me, I'm hungry. I really want to get access to my resources, I refuse to be live-locked.\"","width":320},{"text":"So, on the third try, I get a lot more aggressive and I don't do this \"trylock\", right, when my \"tries_left\" has been decremented to zero, I just say \"ah, just grab the right fork.\"","width":1024},{"text":"And I'm refusing to play anymore games. I'm just gonna grab that right fork.","width":384},{"text":"So, on the third go,","width":256},{"text":"We say, \"no, I will pick up the fork on my left, and I'm gonna wait until I can pick up the fork on the right.\"","width":576},{"text":"So then yes, we could be unlucky, it could so happen that there is a precise moment in time when all five philosophers are holding onto their left fork.","width":896},{"text":"And they've all done these games of trying to do \"trylocks\" etc.","width":256},{"text":"But on the third time, they all decide \"ah, I'm just gonna wait until I can grab that other mutex.\"","width":384},{"text":"And if that happens...","width":128},{"text":"The system deadlocks.","width":64},{"text":"Yes? So.","width":64},{"text":"So if they all end up in here","width":128},{"text":"If all five philosophers end up in here","width":192},{"text":"Then we have a problem. We're gonna have deadlock again, we're back to our original problem.","width":384},{"text":"So we haven't solved it;","width":128},{"text":"We've just written code that appears to work.","width":192},{"text":"Right. Let's see if we can prove this.","width":384},{"text":"Right, so, we can see a way that deadlock could happen.","width":896},{"text":"Do I have... right... okay, right, so...","width":896}]