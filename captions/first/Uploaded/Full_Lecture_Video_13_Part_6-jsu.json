[{"text":"okay so I only have about five more minutes left I don't think I'm going to be able to ","width":192},{"text":"any more questions left about this sorry","width":192},{"text":"any more questions about the ring buffer","width":256},{"text":"okay the back half of the page","width":256},{"text":"is return to the reader-writer problem","width":448},{"text":"okay","width":192},{"text":"so you guys remember what the reader-writer problem is?","width":512},{"text":"so there's a couple of rules when you're doing a reader-writer problem","width":192},{"text":"1. how many readers can you have at the same time?","width":320},{"text":"as many as you want","width":128},{"text":"how many writers can you have at the same time","width":192},{"text":"one","width":64},{"text":"can you have readers and writers at the same time?","width":192},{"text":"no","width":64},{"text":"so our first rule is exclusion","width":256},{"text":"one writer multiple readers","width":128},{"text":"that also means that whatever solution I design I want to be able to allow multiple readers to simultaneously read","width":576},{"text":"but only one writer to write at the same time","width":256},{"text":"so was there anything else?","width":256},{"text":"yes and we want to make sure that whatever solution we come up with doesn't starve either the readers or the writers","width":896},{"text":"so you guys saw condition variables right?","width":192},{"text":"so just to refresh your memory","width":256},{"text":"inside a condition variable","width":192},{"text":"inside the system it's doing an unlock on a mutex","width":256},{"text":"it's blocking on a signal","width":128},{"text":"so it's waiting for something","width":128},{"text":"and then when it's done it locks it","width":64},{"text":"and then it returns","width":128},{"text":"so whenever you call a condition variable","width":192},{"text":"you call it with both that condition variable and a lock","width":384},{"text":"what state does that lock have to be in?","width":128},{"text":"locked","width":64},{"text":"because in the system the first thing that happens is the system unlocks it for you","width":256},{"text":"but all that is done atomically-ish","width":192},{"text":"don't worry about that word","width":128},{"text":"it's all done in one step so you don't have to worry about race conditions inside the condition variable","width":320},{"text":"okay","width":64},{"text":"so here's my first solution","width":320},{"text":"to the reader-writer problem","width":128},{"text":"I'm going to lock a mutex and then I'm going to say ","width":512},{"text":"I have some variables here","width":192},{"text":"I have writing ","width":192},{"text":"that means somebody's writing","width":128},{"text":"and I have reading","width":192},{"text":"and that tells me how many the number of readers inside","width":320},{"text":"what value can writing be?","width":192},{"text":"zero one ","width":128},{"text":"reading can be whatever doesn't matter","width":128},{"text":"first thing I'm going to do is lock my variable and call","width":384},{"text":"and while somebody is writing I'm going to call my condition wait","width":256},{"text":"if somebody if there's a writer in there I'm going to wait for the writer to signal that they're done","width":320},{"text":"and then I can go on","width":192},{"text":"once that's done I increment reading","width":192},{"text":"I do my reading, I decrement reading, I signal that I'm done and I lock","width":320},{"text":"similarly, on the writer side ","width":192},{"text":"they lock","width":128},{"text":"if there's anybody reading or writing","width":128},{"text":"remember writers are exclusive they can't have anybody in there","width":192},{"text":"I wait increment writing, decrement writing call the condition variable","width":384},{"text":"if anybody, this we're a little bit short for time","width":384},{"text":"so is anybody off the top of their head see a problem with this","width":320},{"text":"there's only one reader at a time","width":256},{"text":"what's causing that?","width":64},{"text":"the lock, right, so the lock goes from here to here","width":320},{"text":"once I try to read and I acquire the lock nobody else can come in","width":256},{"text":"does anybody know how I can fix that?","width":256},{"text":"there's an easier way to do that?","width":192},{"text":"any other suggestions?","width":192},{"text":"well I have to lock","width":64},{"text":"but you're closer it does have to do with the lock","width":320},{"text":"what if we unlock the lock","width":192},{"text":"unlock before the reading and then relock","width":384},{"text":"right?","width":320},{"text":"because this unlock will let the other readers pass","width":256},{"text":"the writers will get here and stop","width":320},{"text":"because I've already incremented my reading so the writers aren't going to be able to get into the critical section, but the other readers will","width":384},{"text":"there's another problem","width":448},{"text":"am I done?","width":64},{"text":"give me one more problem here","width":192},{"text":"there's two more problem, we'll finish them on wednesday","width":192},{"text":"say that again?","width":384},{"text":"if there's a stream of readers","width":256},{"text":"if readers keep coming and keep coming and there's never no readers","width":256},{"text":"we're going to starve our writers","width":128},{"text":"one more problem","width":64},{"text":"I lied","width":128},{"text":"look at the writers for a second there's a problem here","width":448},{"text":"what does that do?","width":256},{"text":"what does a condition signal do?","width":448},{"text":"it wakes up what?","width":64},{"text":"no","width":128},{"text":"it wakes up ","width":128},{"text":"wakes up one reader","width":128},{"text":"what do i need to change that to?","width":128},{"text":"condition broadcast","width":256},{"text":"okay","width":128},{"text":"I want you guys to think about the better solution for a reader-writer","width":384},{"text":"we'll go over that at the beginning of class on Wednesday","width":256},{"text":"and we'll talk about deadlock","width":256}]