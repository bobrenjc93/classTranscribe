[{"text":"okay so here's our plan","width":256},{"text":"we're going to use something called","width":128},{"text":"mmap","width":128},{"text":"and when you say \"Hey, I want to map some virtual memory\"","width":384},{"text":"we need to say","width":192},{"text":"what kind of memory do we want?","width":128},{"text":"do we want memory that is readable?","width":192},{"text":"writable? or executable?","width":128},{"text":"some combination of the above?","width":128},{"text":"so typically we will want at least read and write access","width":320},{"text":"so here's our protection","width":192},{"text":"so this is how, if you","width":384},{"text":"if your process tried to, say, change a byte of libc","width":320},{"text":"the virtual memory hardware would say \"Hold on a moment! ","width":192},{"text":"you don't have write access to that file.","width":128},{"text":"I'm going to let you proceed any further\" and it would raise a signal","width":256},{"text":"but we want to do more than that","width":256},{"text":"we actually want to be able to modify the file","width":64},{"text":"and we're going to actually change the contents","width":256},{"text":"of our file just by writing into memory","width":192},{"text":"which I think is pretty cool","width":128},{"text":"the other thing we're going to see is","width":256},{"text":"this map shared","width":128},{"text":"which means that changes we make","width":192},{"text":"are shared with the file","width":384},{"text":"sudo change owner to be angrave","width":2752},{"text":"run vim, great","width":320},{"text":"now, there's a gotcha with using mmap","width":384},{"text":"which is that it's not going to automatically extend the file for us","width":256},{"text":"so if want to be able to, say, store a few integers","width":256},{"text":"in our memory-mapped space","width":64},{"text":"then we better make sure that our file is big enough before-hand","width":192},{"text":"so let's do that","width":256},{"text":"first let me look at a file descriptor","width":256},{"text":"and I'll open the file called data","width":128},{"text":"I want read and write","width":64},{"text":"if it doesn't exist, I want to be able to create it","width":192},{"text":"if it does exist, I'm going to truncate it","width":128},{"text":"and here's my permission bits, 0600","width":128},{"text":"what does 0600 mean?","width":128},{"text":"the 0 and the beginning means I'm going to speak octal","width":192},{"text":"and the 6 means","width":128},{"text":"I want read and write permission","width":192},{"text":"and everyone else, ha! nothing for you","width":128},{"text":"we're making this a private file","width":192},{"text":"we need a way to be able to extend this file","width":320},{"text":"how can I do that?","width":256},{"text":"any ideas?","width":512},{"text":"how about using seek","width":384},{"text":"there's two ways to do this: we could have actually written enough bytes","width":192},{"text":"so we could have written size time size number of bytes into my file","width":384},{"text":"but another way do it is just to deliberately seek","width":192},{"text":"to a new end-point, and we'll write something in there","width":192},{"text":"so let's seek","width":256},{"text":"on my file descriptor","width":128},{"text":"who remembers how to use seek?","width":128},{"text":"I want to go this far into the file","width":192},{"text":"and remember we can like seek end","width":256},{"text":"seek beginning, we can say seek set","width":64},{"text":"and I'm going to write just one byte in here","width":256},{"text":"so let me write into my file descriptor","width":128},{"text":"here's a pointer to some data I want to send","width":128},{"text":"I'll just send, say, abc","width":128},{"text":"and I'll send those three bytes","width":192},{"text":"and in doing that, I've made sure that","width":128},{"text":"my file is more than","width":192},{"text":"this size","width":64},{"text":"so that's just the easiest way of","width":192},{"text":"extending the size of a file","width":128},{"text":"now we do our map","width":128},{"text":"and if it works, we get back a valid address","width":256},{"text":"for now","width":576},{"text":"I can treat that address","width":256},{"text":"as some memory that I can now use","width":128},{"text":"so I'm going to write into","width":192},{"text":"my memory","width":128},{"text":"12345678","width":128},{"text":"and this other hexidecimal constant called dead code","width":256},{"text":"to make sure that","width":256},{"text":"the changes in memory are","width":320},{"text":"written back to the file after","width":128},{"text":"I should unmap it, so how do I do that?","width":192},{"text":"I call munmap and we're done","width":128},{"text":"so let's compile this","width":192},{"text":"undefined reference to seek","width":1600},{"text":"what did we do wrong there?","width":192},{"text":"sudo chmod angrave","width":1280},{"text":"everything","width":64}]