[{"text":"This sounds really easy when I'm presenting it in lecture.","width":320},{"text":"Writing malloc is a right of passage","width":512},{"text":"Meaning that you too can have gray hair and fuzzled eyes and look just like me...no","width":576},{"text":"What I mean is that it's tricky because now we have to start dealing with pointer arithmatic","width":576},{"text":"Now we have to start dealing with multiple pointers","width":64},{"text":"A little error like writing pa instead of pb or adding instead of subtracting can bite you big time","width":512},{"text":"And worse it won't bite you in an obvious way","width":320},{"text":"For example suppose that you didn't actually add enough bites","width":256},{"text":"You didn't add 20. You added a smaller number.","width":128},{"text":"Then the user program just overwrites your pointer values.","width":320},{"text":"Of course it crashes","width":128},{"text":"Later when someone calls free and you try to read these values and these values are just garbage","width":384},{"text":"Like what happened to my values!","width":64},{"text":"Why aren't my values correct?","width":192},{"text":"The only thing that can bite you is...","width":128},{"text":"sizeof","width":256},{"text":"So remember if you've got a struct for example","width":256},{"text":"That you've set up to hold these values","width":192},{"text":"Or an array","width":192},{"text":"The sizeof an object or struct is very different from the sizeof a pointer to something","width":512},{"text":"Or sizeof a pointer to an array is different from the sizeof an array","width":384},{"text":"So one little character here can really really bite you","width":256},{"text":"So my advice is to get started early when we put this out and to program slower than you've ever programmed before","width":704},{"text":"Make each line a work of art that you would trust your life to","width":448},{"text":"It still won't work, but at least you've tried really really hard","width":512},{"text":"Yes Question","width":64},{"text":"sizeof doesn't work like that","width":128},{"text":"sizeof is a compiler thing that runs at compile time","width":448},{"text":"so it uses the type ok so sizeof says \"oh look I'm looking at a pointer\"","width":320},{"text":"Pointers on my machine are 4 bytes or 8 bytes","width":128},{"text":"Ok it does not do anything at run time","width":384},{"text":"Alright how are we doing for itme","width":192},{"text":"Ok","width":128},{"text":"We will finish with something really really easy. calloc and realloc","width":128},{"text":"calloc and realloc easy after you've done malloc","width":704},{"text":"These are easy. You can implement them in terms of malloc and free","width":384},{"text":"So realloc says \"guess what...I need some more space\"","width":384},{"text":"Here's a pointer that I previously got from my malloc call or calloc call","width":448},{"text":"Basically a heap pointer, a pointer to some memory. And here's how much memory I need now","width":384},{"text":"I've decided that my array needs to be larger","width":128},{"text":"Realloc will do that for you","width":128},{"text":"But be careful, here's how realloc is supposed to work","width":256},{"text":"It says \"look, I'll try to find some bigger space.","width":192},{"text":"If you're asking for more space, then if necessary I will copy everything across and return a pointer back to you","width":448},{"text":"If it fails however, it returns NULL","width":192},{"text":"So be careful when using realloc. Always check it's return value.","width":256},{"text":"Because it may have decided to shuffle things around for you.","width":256},{"text":"I couldn't extend this. I have something else using the memory just next to you.","width":384},{"text":"So I had to allocate a new block.","width":128},{"text":"But you can implement realloc directly just using malloc and free","width":256},{"text":"Calloc","width":256},{"text":"Calloc is very similar to malloc","width":448},{"text":"What calloc does is it zeroes memory","width":448},{"text":"So it's a bit slower than malloc","width":192},{"text":"Also you give it 2 parameters","width":384},{"text":"You say this is my element size and this is the number of elements","width":192},{"text":"And so the amount of memory it's going to allocate is size times number","width":320},{"text":"Why somebody thought calloc needed two arguments, I have no idea","width":256},{"text":"They should have just made it with just a single argument","width":192},{"text":"The first thing it does just multiply these two numbers together","width":192},{"text":"Except it has to do it the hard way because you could get integer overflow","width":320},{"text":"But anyway, calloc is essentially malloc plus it zeroes the memory","width":320},{"text":"Fastest way to zero memory is to use memset","width":448},{"text":"And we are out of time. Yes! And with that it's 11:50. Have a wonderful week. I will be going down to the lab now.","width":448},{"text":"After I've answered questions incase people want to help setup the android ndk","width":448}]