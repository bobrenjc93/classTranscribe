[{"text":"[silence]","width":9024},{"text":"okay so let's sketch out some ideas, remember the basic form of when you call merge sort","width":512},{"text":"is we pass in some sort of like low and high we calculate a mid point","width":320},{"text":"and then the first thing we do is ","width":256},{"text":"say okay do merge sort say from low to mid","width":256},{"text":"and merge sort from mid to high","width":320},{"text":"and then finally, do the merge to take those two halves, copy all the values in order in some sort of scratch space and then copy that back into the main array","width":768},{"text":"so maybe what we could do is say well look let's in these two calls here ","width":512},{"text":"let's do these independently right? so our first idea might be","width":256},{"text":"that instead of calling these directly","width":192},{"text":"I will call pthread_create ","width":192},{"text":"and obviously I want to know","width":640},{"text":"what it's doing","width":64},{"text":"and I'll pass in some sort of task","width":256},{"text":"infromation","width":128},{"text":"so on the heap I'll make a little struct that says okay go from this value up to this value","width":448},{"text":"I'll create a little struct and I'll pass in a pointer to that struct","width":256},{"text":"and my little function that runs can take that task, read the contents, and when it's finished it will free it","width":448},{"text":"so I'm creating the memory, but the other thread will call it","width":192},{"text":"and similarly on this one, we'll call pthread_create","width":128},{"text":"and we'll call this task two","width":256},{"text":"and then I better wait before doing any merge, I've got to wait for these two threads to finish","width":448},{"text":"okay so then I'm going to call pthread_join on t_id one and pthread_join on t_id two","width":448},{"text":"so that might be my first attempt","width":256},{"text":"so some things to comment on this is first of all, we've got a running thread, why not use it?","width":576},{"text":"so what are we doing? we're saying hey create two threads and then just sit around and block until these two other threads have finished","width":576},{"text":"well that seems a little bit kind of inefficient","width":256},{"text":"we should have actually used the calling thread as well","width":192},{"text":"so we might for example try to speed this up a little bit by saying you know what just execute the second task myself directly","width":512},{"text":"but even this is going to create a lot of threads","width":256},{"text":"way more threads than actual CPU cores that I have","width":320},{"text":"and you could imagine that say I'm dealing with several megabytes of data","width":448},{"text":"and I'm splitting into these little two hundred and fifty six integers","width":256},{"text":"then that's many many threads","width":128},{"text":"so maybe we should be a little bit more clever in how we do this and get even better performance","width":512},{"text":"and that's where the idea of a thread pool comes in","width":192},{"text":"here's what we'll do, we'll make a preset number of threads","width":320},{"text":"and then we'll treat them to work, we'll actually separate them from the actual tasks that we want each one to do","width":576},{"text":"instead we'll put our tasks into a queue","width":320},{"text":"hey guess what, this is starting a bit like producer consumer","width":320},{"text":"our threads will go to the queue and say hey what's next what's next give me some work","width":256},{"text":"if there's no work for them to currently do","width":128},{"text":"that request will block until another thread puts some work into the queue","width":448},{"text":"right? so we've actually got conceptually now a whole load of threads going back to the queue saying okay I'm free give me some more work","width":576},{"text":"give me a little task structure and that might even have a pointer to a function","width":320},{"text":"and some other additional notes","width":128},{"text":"and integers etc and pointers to floats, whatever to actually perform the work","width":384},{"text":"so we think of our little thread as a little worker","width":192},{"text":"that just keeps going back to this and say okay I'm ready to consume the next task","width":320},{"text":"so our second idea then is to do thread pool","width":384},{"text":"that uses the ideas we've learned from the producer consumer and its consumer is consuming","width":704},{"text":"tasks","width":128},{"text":"now we have to be a little bit careful in this because suppose we've just finished creating let's say this block","width":1536},{"text":"right? our task was to do the merge and to create this block","width":256},{"text":"another thing might be to say okay not I've finished this I should put in a new task into the producer","width":512},{"text":"I should submit a new job and that is to do this big merge","width":256},{"text":"but we have to be careful, we have to make sure that the other half of the data is actually ready is actually finished","width":576},{"text":"now, I'm not going to elaborate all of the ways you could do this because we're going to do a little competition and see who can actually write the fastest merge sort","width":832},{"text":"but I'll give you one idea","width":128},{"text":"and that's this: don't start on all of the five hundred and twelve jobs until you've finished all of the smaller jobs","width":512}]