[{"text":"so we need to do a context switch","width":384},{"text":"for example, you're gonna need your CPU to start working on a different thread","width":448},{"text":"or start working on a different process","width":128},{"text":"so a context switch as far as we're concerned, we save the CPU state","width":384},{"text":"my question for you is what should we do with the TLB","width":384},{"text":"is it still valid, are there the entries in the TLB still valid in a context switch?","width":640},{"text":"what.. take a moment to talk about it with your neighbor","width":384},{"text":"okay so the question is... what should we do with the TLB","width":4544},{"text":"we got these lookups from a page to a particular frame of memory","width":384},{"text":"and what happens during a context switch well its a trick question","width":384},{"text":"it depends on the kind of context switch","width":192},{"text":"because here's one example, suppose we got our CPU to stop working on one particular thread of our process and please instead start working on this other thread of the same process","width":704},{"text":"all our virtual memory is still the same","width":384},{"text":"since inside the same process","width":128},{"text":"so all the cache lookups that we've done ... we can keep that","width":192},{"text":"ok here's a different example","width":64},{"text":"suppose we tell the CPU to stop working on this process and start working on another process","width":384},{"text":"our virtual memory is no longer the same","width":256},{"text":"the address is no longer mapped to the same pieces of memory, so then if we swapped another process we should clear the TLB","width":512},{"text":"the state of the TLB is only relevant to a particular process because virtual memory addresses are unique to each process","width":1152},{"text":"as long as is... it depends on how much money you have to spend","width":1344},{"text":"alright so our processes are working along one day and tries to do a simple read or write to an array, an ah! the TLB says 'i have no memory of this page' and a few nanoseconds hundred nano seconds later, we finished walking through the page tables and hah! NOTHING. nothing i got nothing of this particular page number. it doesn't actually point to a piece of real memory. what happens?","width":2688},{"text":"its on the harddrive. yes! we can cheat","width":576},{"text":"ok heres the beautiful thing about virtual memory is that we can lie to our processes","width":320},{"text":"is that, they are like inception, live in inside virtual world in virtual memory","width":640},{"text":"and we actually need to have their data in physical RAM when our processes try to read or write it","width":448},{"text":"for the rest of the time, haha! we can just dispose of it and use that ram for other things for other processes that always want to access memory","width":640},{"text":"ok so where it can be find. it might be found on disk inside secondaray storage","width":448},{"text":"ok so, we can store it","width":192},{"text":"where might you find it? for example","width":448},{"text":"what's known as a swap file","width":256},{"text":"or in linux: a swap partition","width":576},{"text":"where area of your disk is not used for storing/making files but for storing this copy of memory","width":448},{"text":"so we can swap out","width":192},{"text":"a page at a time","width":64},{"text":"and store it on disk","width":256},{"text":"and we'll leave it there until ","width":256},{"text":"and attempt to read/write memory fails","width":512},{"text":"stop and think how that might work","width":192},{"text":"alright your processes are like \"okay read this piece of the array, or read this variable, or call this function\"","width":512},{"text":"at that moment, the hardware says \"oh guess what\" this virtual memory address doesn't correspond to a physical address","width":512},{"text":"i better kill the process","width":128},{"text":"the hardware of course doesn't actually kill the process","width":192},{"text":"instead what it does, it raises an interrupt on the CPU","width":384},{"text":"and we have to write some operating system code that says \"aha look at that!\"","width":384},{"text":"\"our memory hardware is complaining. it couldn find it\"","width":448},{"text":"we got two options at this point","width":64},{"text":"we could say \"clearly this process is a bad program, and that address is just invalid; it was trying to read a bad segment of memory. segfault\"","width":832},{"text":"Or it says \"hold on hold on. dont look! and pull the relevant data from the relevant disk and stick it to memory\"","width":704},{"text":"itll be like trying to call comcat and they employed people in that time that you actually called them up","width":384},{"text":"'hello i'd like to complain....","width":128},{"text":"'um so","width":128},{"text":"we can do something clever right here and that is where","width":320},{"text":"the dirty bit comes in","width":192},{"text":"with each frame of memory, we can store a little bit of matter information about how its being used by the process","width":704},{"text":"for example","width":256},{"text":"has this piece of memory ever been modified","width":256},{"text":"as long as its dirty","width":192},{"text":"why didnt we call it the modification bit I DONT KNOW ","width":128},{"text":"but anyway its the dirty bit","width":128},{"text":"to say that the contents of this memory has changed since it was first created","width":448},{"text":"either loaded in from disk or malloc'd when you expanded the heap ","width":512},{"text":"but the point is we got stuff in memory that we care about","width":128},{"text":"so if the dirty bit is set, we know that if we want to put this data on to disk, we actually got to save it","width":704}]