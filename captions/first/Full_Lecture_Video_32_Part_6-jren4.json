[{"text":"great okay so we've got time for a final little demo","width":384},{"text":"and what we're going to do is instead of the system stealing one of our threads","width":576},{"text":"to handle a signal","width":192},{"text":"we are going to explicitly create a thread","width":256},{"text":"that pulls signals one at a time and handles them","width":192},{"text":"so its more code to write","width":128},{"text":"but it's less likely to.. it own't suffer from asynchronous signal problems if we're careful about how we...","width":640},{"text":"process our signals","width":192},{"text":"so let's.. I'll show you what I mean","width":192},{"text":"so what we're looking at today is... using SIGWAIT","width":384},{"text":"and I'm going to put that inside a thread","width":384},{"text":"who's only job is to say okay tell me the next signal that's delivered","width":320},{"text":"we can tell it in this case the mask is which signals do I care about","width":832},{"text":"[silence]","width":1408},{"text":"so if I get a SIGINT, do some code, do some code","width":256},{"text":"so for example, Java, if you sent it a SIGHUP will print out a whole load of debugging information about the garbage collector and other internals of the...","width":896},{"text":"stack traces and other internals of the JVM","width":256},{"text":"the apache webserver if you send it a SIGHUP signal will reread its configuration files","width":384},{"text":"so that you can make updates to the webserver without having to restart the process and deny people that are currently connected to it","width":576},{"text":"so this might be a way to do this, you could say oh look if I've got um...","width":320},{"text":"SIGHUP","width":64},{"text":"if I get this signal... then print something out or","width":320},{"text":"reread my configuration data","width":192},{"text":"today I'm just going to show you a demo with just a couple of these","width":320},{"text":"and we've got a little default case for our own purposes that calls fprintf","width":320},{"text":"which we wouldn't call normally inside the signal handler","width":192},{"text":"because it could be that the thread that we've stolen it from is already inside fprintf or inside malloc etc","width":512},{"text":"but by using our own explicit thread, we can do this, we can do it in a safe way","width":320},{"text":"right so let's have a look at a demo...","width":192},{"text":"yay okay great","width":384},{"text":"right so here's our plan","width":576},{"text":"we will set because we're a multithreaded process","width":512},{"text":"we will set our sigmask before creating other threads","width":192},{"text":"so that when we create a new thread, it inherits the same mask","width":256},{"text":"and our default mask today rather than just saying okay ignore everything","width":384},{"text":"what I'm going to do is [something] and just put in two bits","width":256},{"text":"the bit for SIGINT and the bit for SIGTERM","width":192},{"text":"that means that if someone sends me a SIGINT of course there's no thread that is prepared to catch it","width":384},{"text":"both threads are blocking these signals","width":384},{"text":"and here's my application code","width":384},{"text":"sleep one, print dot and because I want to see the dots immediately I'm turning to my C library to immediately flush anything inside the C buffers","width":448},{"text":"so we can see the dots appear one a second","width":320},{"text":"and inside my thread, here we go, today I've got my...","width":448},{"text":"my important code that's going to present some debugging information","width":384},{"text":"what is that? oh it's just the name of the signal that was delivered","width":256},{"text":"okay so let's compile this","width":128},{"text":"right if I was going to compile it...","width":320},{"text":"like this, what will we see?","width":128},{"text":"it will complain right? undefined reference no one defined pthread_sigmask","width":448},{"text":"what we forgot to do is to tell gcc that we're trying to compile a multithreaded program so...","width":512},{"text":"here we go let's give it a pthread option good and now we've got ourselves a little demo","width":320},{"text":"and every second it's printing out dot and then flushing the buffer","width":384},{"text":"so if we now send it a signal...","width":128},{"text":"our single thread wakes up, returns from SIGWAIT and runs the code inside that case statement which just prints out SIGINT","width":576},{"text":"where did the control C come from? oh that's just the shell telling us that it sent a control C","width":384},{"text":"and so I can say ok stop stop stop stop stop and of course it never stops","width":384},{"text":"alright and but I can still call SIGQUIT and that will terminate the program","width":448},{"text":"and with that have a wonderful weekend and I'll publish a online version of these questions in subversion","width":704},{"text":"thank you very much!","width":64}]